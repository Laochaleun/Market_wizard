v0.5.6 (2026-02-08) - Stage 2 calibration/anchors iteration (in progress, not production-ready)
- Continued Stage 2 SSR tuning with focus on closing production gates while preserving paper-style purchase-intent behavior.
- Introduced anchor-variant framework with bilingual (PL+EN) variants:
  - `paper_general_v1`
  - `paper_general_v2`
  - `paper_general_v3`
  - default switched to `paper_general_v3` in `backend/app/i18n.py`.
- Added anchor-variant selection plumbing in evaluation/training scripts:
  - `backend/scripts/validate_production_readiness.py` (`--anchor-variant`)
  - `backend/scripts/tune_ssr_hierarchical.py` (`--anchor-variant`)
  - `backend/scripts/build_domain_calibration_policy.py` (`--anchor-variant`)
- Added policy-search expansion in production validation:
  - renamed `ecommerce_only_calibrated` -> `purchase_intent_only_calibrated`,
  - added `purchase_domain_only_calibrated`,
  - added `purchase_hybrid_0.1 ... purchase_hybrid_0.9` candidates.
- Runtime/domain naming aligned with paper intent framing:
  - simulation path now passes `domain_hint="purchase_intent"` instead of `ecommerce`,
  - compatibility alias kept in `DomainCalibrationPolicy.select()` for old artifacts.
- Added paper-native diagnostics in production validation report:
  - KS similarity (`1 - KS distance`) on rounded rating distributions,
  - split-half ceiling proxy,
  - correlation attainment proxy.
- Added robust offline/cache handling in validation script:
  - fallback loading from local HF cached `.arrow` files,
  - graceful dataset skip with explicit warnings when unavailable.
- Added global calibrator builder script:
  - `backend/scripts/build_global_calibrator.py`
  - supports `--optimize {mae,off1,balanced}` and writes `isotonic_v1` artifact.
- Re-trained and iterated artifacts multiple times:
  - `backend/app/data/ssr_calibrator_default.json`
  - `backend/app/data/ssr_calibration_policy_default.json`
- Key full-run reports generated during this stage:
  - `reports/production_readiness_validation_2026-02-07_stage2_anchor_refined.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_anchor_refined_v3_full.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_anchor_v3_retrained_full.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_policy_hybrid_search.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_oldcal_newpolicy_hybrid.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_policy_retrained_purchase_app.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_newcal_oldpolicy_hybrid.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_global_off1_calibrator.md`
  - `reports/production_readiness_validation_2026-02-07_stage2_global_balanced_calibrator.md`
- Best near-pass result in this stage:
  - policy: `purchase_intent_only_calibrated`
  - MAE: `0.6092` (target `<= 0.60`, gap `0.0092`)
  - Off1: `0.9189` (target `>= 0.92`, gap `0.0011`)
  - Spearman drop + max dataset regression gates passed.
- Final status of this commit:
  - Stage 2 significantly advanced and better instrumented,
  - but still **not production-ready** (`Decision: FAIL` on hard gates).

v0.5.5 (2026-02-07) - Stage 1 calibration framework and external validation
- Switched runtime SSR defaults to match calibration training setup:
  - `SSR_TEMPERATURE=1.0` in `backend/app/config.py` and `backend/.env.example`.
- Added first-stage post-SSR calibration runtime infrastructure:
  - shared calibrator module `backend/app/services/score_calibration.py`,
  - support for `isotonic_v1` artifacts and `domain_calibration_v1` policy artifacts,
  - new settings:
    - `SSR_CALIBRATION_ENABLED`
    - `SSR_CALIBRATION_ARTIFACT_PATH`
    - `SSR_CALIBRATION_POLICY_PATH`
- Added default calibration artifacts in repository for HF fallback (no `.env` assumption):
  - `backend/app/data/ssr_calibrator_default.json`
  - `backend/app/data/ssr_calibration_policy_default.json`
- Integrated domain-aware calibration in scoring path:
  - `SSREngine` now accepts `domain_hint` and routes calibration via policy/default calibrator.
  - `SimulationEngine` passes `domain_hint="ecommerce"` to SSR scoring.
- Extended hierarchical tuning script to include calibration validation:
  - OOF validation (`--calibration-cv-folds`),
  - holdout validation (`--calibration-holdout-ratio`),
  - artifact export (`--calibration-artifact-out`),
  - offline fallback switch (`--skip-industries`).
- Added domain calibration policy builder:
  - `backend/scripts/build_domain_calibration_policy.py`
  - supports domain-specific fitting (`general`, `ecommerce`) and `--optimize {mae,off1}`.
- Added production-readiness validation suite:
  - `backend/scripts/validate_production_readiness.py`
  - evaluates external datasets (Amazon 2023, Yelp, App Reviews, Allegro),
  - computes bootstrap CIs and production gates,
  - compares calibration policies (`raw`, `global`, blends, domain policy artifact).
- Added/updated tests:
  - `backend/tests/test_score_calibration.py`
  - `backend/tests/test_ssr_engine.py` (raw vs calibrated and domain-hint routing)
- Stage 1 outcome:
  - best policy on current benchmark: `ecommerce_only_calibrated`,
  - production gates still not met (`Decision: FAIL`) on `reports/production_readiness_validation_2026-02-07.md`.

v0.5.4 (2026-02-07)
- Added post-SSR calibration validation workflow in `backend/scripts/tune_ssr_hierarchical.py`:
  - out-of-fold calibration validation (`--calibration-cv-folds`),
  - holdout validation (`--calibration-holdout-ratio`),
  - explicit calibration artifact export (`--calibration-artifact-out`, JSON `isotonic_v1`).
- Added shared calibration utilities module:
  - `backend/app/services/score_calibration.py` (fit/transform/save/load).
- Added runtime calibration support in SSR engine:
  - new config flags: `SSR_CALIBRATION_ENABLED`, `SSR_CALIBRATION_ARTIFACT_PATH`,
  - `SSREngine` now applies calibrator to expected score when enabled.
- Added tests:
  - `backend/tests/test_score_calibration.py`,
  - calibration integration assertion in `backend/tests/test_ssr_engine.py`.
- Added domain-aware calibration routing:
  - `DomainCalibrationPolicy` in `backend/app/services/score_calibration.py`,
  - `SSREngine` now supports `domain_hint` and policy artifact loading via `SSR_CALIBRATION_POLICY_PATH`,
  - simulation flow sends `domain_hint="ecommerce"` for product intent scoring.
- Added production-readiness validation suite:
  - `backend/scripts/validate_production_readiness.py` (external datasets, CI gates, policy search).
- Added default domain policy artifact:
  - `backend/app/data/ssr_calibration_policy_default.json` (general=identity, ecommerce=calibrated).

v0.5.3 (2026-02-07) - Pre-calibration baseline
- Added hierarchical SSR tuning tooling:
  - `backend/scripts/tune_ssr_hierarchical.py` (global + per-group tuning, report generation)
  - `backend/scripts/validate_grouped_ratings_csv.py` (CSV validator for grouped labeled data)
  - `backend/scripts/build_poland_grouped_csv.py` (Polish grouped dataset builder)
  - `backend/scripts/ssr_grouped_ratings_template.csv` (input template)
- Added benchmark reports for large-scale tuning and hybrid PL+industry runs:
  - `reports/ssr_hierarchical_tuning_2026-02-07.md`
  - `reports/ssr_hierarchical_tuning_2026-02-07_large.md`
  - `reports/ssr_hybrid_tuning_pl_2026-02-07.md`
  - `reports/ssr_hybrid_tuning_pl_precise_2026-02-07.md`
  - `reports/ssr_hybrid_tuning_pl_precise_auto_anchor_2026-02-07.md`
- Set runtime SSR defaults to the best fixed setup from benchmarks:
  - `SSR_TEMPERATURE=0.7`
  - `SSR_EPSILON=0.0`
  - wired via `backend/app/config.py`, `backend/app/services/simulation_engine.py`, and UI default in `frontend/main.py`.
- Unified environment templates and removed duplication:
  - kept `backend/.env.example` as canonical template,
  - removed `backend/.env.sample`,
  - updated README setup command accordingly.
- This commit is intentionally marked as a rollback-safe point before calibration work.

v0.5.2 (2026-02-07)
- Added SSR parity validation against `/Users/pawel/semantic-similarity-rating/semantic_similarity_rating` (core PMF + temperature scaling).
- Updated and fixed SSR unit tests in Market Wizard to match current anchor set loading (`get_anchor_sets`).
- Added real-data benchmark script for labeled datasets (`backend/scripts/evaluate_ssr_on_real_data.py`) with model comparison metrics (MAE, Spearman, exact/off-by-one accuracy).
- Added 20-industry benchmark script based on Amazon Reviews 2023 category JSONL streams (`backend/scripts/evaluate_ssr_20_industries.py`).
- Added benchmark report with conclusions and operational guidance in `reports/ssr_embedding_benchmark_2026-02-07.md`.
- Switched default embedding model to `BAAI/bge-m3` in config fallback (`backend/app/config.py`) and local env (`backend/.env`), including documentation updates.

v0.5.1 (2026-02-07)
- Fixed gender mapping bug in UI: selecting `K` (PL) now correctly maps to backend `F` instead of falling back to "all genders".
- Localized respondent gender labels in generated reports (`K/M` for Polish, `F/M` for English).
- Added end-to-end regional targeting (voivodeship) in UI and persona generation (`target_audience.region`).
- Region now affects persona location selection (when matching cities are available) and regional income multiplier calculation.
- Added bilingual demographic dropdown normalization (PL/EN labels) with preserved values on language switch.
- Unified demographic filters across analyses: A/B test, price analysis, and focus group now reuse the same target audience settings as main simulation.
- Added automated tests for: gender mapping, report label localization, and region-aware persona generation.

v0.5.0 (2026-02-01)
- Aligned SSR computation with the reference implementation (cosine scaled to [0,1], epsilon on min only, temperature applied post-PMF).
- Set SSR defaults to temperature=1.0 and epsilon=0.0.
- SSR now scores only the purchase-intent answer (Q3) when long, sourced opinions are generated.
- SSR now generates a separate short purchase-intent statement when web-search opinions are long, matching paper-style elicitation.
- Updated UI defaults to show SSR temperature = 1.0 in Advanced Settings.
- Switched local embedding default to `all-MiniLM-L6-v2` for consistency with the SSR tool.
- Added embedding warmup on startup (API + UI) to pre-download the local model (works on HF Spaces).
- Added `EMBEDDING_WARMUP` flag to disable warmup when needed (default: on).
- Updated docs to list supported embedding models and clarify automatic local model download.

v0.4.0 (2026-01-31)
- Integrated GUS 2024 data for Income Levels: 5 new categories (Very Low to Very High) based on official decile/quintile net income ranges.
- Integrated GUS 2024 data for Location/Urbanization: 5 new categories (Rural, Small City, Medium City, Large City, Metropolis) with accurate population weights (~41% rural, ~13% metropolis).
- Updated "Gender" dropdown in Polish interface to use "K" (Kobieta) instead of "F".
- Added `test_personas.py` to verify statistical distribution of occupations, incomes, and locations against GUS benchmarks.
- Refined backend logic to use new granular location and income data for more realistic persona generation.

v0.3.7 (2026-01-31)
- Finalized HF download fix by caching exports in Gradio's cache and returning the cached files via `gr.File`, letting Gradio itself serve `/file=...`.
- Removed custom `/download-report` route in favor of Gradio's native file serving, which avoids HF proxy restrictions.
- Clarified session notes and logs to document the resolved flow (cache copy + __sign handling).

v0.3.6 (2026-01-31)
- Fixed download endpoint routing by mounting Gradio into FastAPI and serving files via a dedicated `/download-report/{filename}` route.
- Export links now use request-aware absolute URLs (base_url / forwarded headers) to play nicely with proxies.
- Added targeted logging around download URL construction and Gradio mount for easier HF debugging.

v0.3.5 (2026-01-31)
- Fixed Hugging Face deployment: Added missing system dependencies (Pango, Cairo, etc.) and Python packages (WeasyPrint, Pandas, pytz).
- Enabled full Playwright support in Docker (Chromium + system dependencies).
- Fixed "File wasn't available on site" error on Hugging Face by relocating report exports to a local 'reports/' directory and configuring Gradio 'allowed_paths'.
- Updated local setup (run.sh) to automatically handle Playwright browser installation.
- Added logging and write permission handling (chmod 777) for persistent report storage on server.
- Synced GitHub (origin) and Hugging Face (hf) repositories for consistent deployment.

v0.3.0 (2026-01-30)
- Overhauled report analysis prompts (PL/EN) for deeper, literal, data-anchored insights and enforced suffixes on recommendations.
- Increased default report analysis max output tokens to 16384.
- Added sanitize pass using the same model to neutralize style and remove storytelling artifacts.
- Enforced recommendation suffixes server-side with automatic validation.
- Added report analysis sanitize cache refresh (v3) in frontend pipeline.

v0.2.0 (2026-01-30)
- Added narrative analysis sections to reports (narrative, agent response summary, sales/marketing recommendations).
- Report analysis now uses Gemini 3 Pro Preview with explicit thinking budget configuration.
- PDF export uses browser rendering (Playwright) for closer HTML parity (fallback to WeasyPrint).
- Web search defaults enabled for simulations, A/B, price analysis, and focus group; sources reused in price analysis.
- Focus group optionally injects market context from cached/search sources.
- Report HTML print layout improvements (avoid page breaks in charts).
- Added report analysis debugging logs.
- Bug fixes for report analysis caching and export regeneration.
- URL extraction flow improvements: visible “Fetch from URL” button with in-flight status and stricter URL detection.
- URL normalization now accepts www.* inputs and uses https:// automatically.
- Reuse extracted URL data across simulation, price analysis, and focus group without re-fetching.
- Persist extracted URL data in projects and reload on project load.
